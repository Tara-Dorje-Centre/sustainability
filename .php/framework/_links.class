<?php 

interface Ilinks{
	public function __construct($menuType = 'DIV',$styleBase = 'menu');
	public function setStyle($styleBase = 'menu');
	public function setType($menuType = 'DIV');
	public function formatToggleLink($elementId = 'formOptional', $linkText = '+Options');
	public function formatHref($caption,$link,$target = '_self',$cssSuffix = '',$onClickJS = NULL);
	public function formatTextItem($text);
	public function openMenu($name = 'menu-listing');
	public function closeMenu();
	public function resetMenu($newLines = 0);
	public function saveMenuSettings();
	public function restoreMenuSettings();
	public function getPagedLinks($baseUrl, $recordCount, $recordsPerPage, $currentPage);
	public function formatCalendarLink($baseUrl, $year, $month);
	public function formatCalendarHref($linkCaption, $baseUrl, $year, $month);
}
class _links implements Ilinks{
	private $_menu;
	private $_list;
	private $cssStyleBase;
	public $cssItem;
	private $cssList;
	private $menuType;
	private $menuName;  

	private $saveMenuType;
	private	$saveBaseStyle;
	private	$saveMenuName;

	public function __construct($menuType = 'DIV',$styleBase = 'menu'){
		$this->setStyle($styleBase);
		$this->setType($menuType);
		
	}

	public function setStyle($styleBase = 'menu'){
		$this->cssStyleBase = $styleBase;
		$this->cssItem = $styleBase.'-links-item';
		$this->cssList = $styleBase.'-links-list';
	}

	public function setType($menuType = 'DIV'){
		$this->menuType = $menuType;
	}

	private function formatItem($content){
		if ($this->menuType == 'LIST'){
			//add list item tag and same style
			$li = new \html\_li($content,$this->cssItem.'-li');
			$item = $li->print();
			//listItem($content,$this->cssItem.'-li');
		} else {
			$item = $content;
		}
		return $item;		
	}
	public function formatToggleLink($elementId = 'formOptional', $linkText = '+Options'){
		$url = '#!';
		$css = 'toggle-link';
		$js = "toggle('".$elementId."');";
		$target = '_self';
		
		$item = $this->formatHref($linkText,$url,$target,$css,$js);
		return $item;
	}
	public function formatHref($caption,$link,$target = '_self',$css = 'display-link',$onClickJS = NULL){
		$a = new \html\_href($link, $caption,$target,$onClickJS);
		 
		$item = $a->href();
		return $item;
	}
	
	protected function spacer($n){
	
	return \html\spacer($n);
	}

	public function formatTextItem($text){
		$content = span($text,$this->cssItem);
		$item = $this->formatItem($content);
		return $item;
	}
	
	public function openMenu($name = 'menu-listing'){
		$this->menuName = $name;
		$this->_menu = new \html\_div($this->menuName,$this->cssList);
		$menu = $this->_menu->open();
		
		if ($this->menuType == 'LIST'){
			$this->_list = new \html\_ul($this->menuName.'-ul',$this->cssList.'-ul');
			$menu .= $this->_list->open();
		}
		return $menu;
	}

	public function closeMenu(){

		if ($this->menuType == 'LIST'){
			$menu = $this->_list->close();
		} 
		$menu .= $this->_menu->close();
		
		return $menu;
	}

	public function resetMenu($newLines = 0){
		if ($this->menuType == 'LIST'){
		
			$menu = $this->_list->close();
			if ($newLines > 0){
				$b = new \html\_br($newLines);
				$menu .= $b->print();
			}
			
			$menu .= $this->_list->open();
			
		} else {
			if ($newLines == 0){
				$newLines = 1;
			}
			$b = new \html\_br($newLines);
			$menu = $b->print();
		}
		return $menu;	
	}

	public function saveMenuSettings(){
		$this->saveMenuType =$this->menuType;
		$this->saveBaseStyle = $this->cssStyleBase;
		$this->saveMenuName = $this->menuName;		
	}

	public function restoreMenuSettings(){
		$this->setType($this->saveMenuType);
		$this->setStyle($this->saveBaseStyle);	
		$this->menuName = $this->saveMenuName;
	}

	public function getPagedLinks($baseUrl, $recordCount, $recordsPerPage, $currentPage){
		$this->saveMenuSettings();
		$this->setType('DIV');
		$this->setStyle('paged');
		$i = 0;
		$pages = 1;
		$linkset;
		$linkCaption;
		$link;
		$linksAllPages = '';
		$minRecord = 1;
		$maxRecord = 1;
		$recordRange;
		//calculate how many pages results will display in
		if (floor($recordCount/$recordsPerPage)==$recordCount/$recordsPerPage){
			$pages = floor($recordCount/$recordsPerPage);
		} else {
			$pages = floor($recordCount/$recordsPerPage) + 1;
		}
		$linkset = $this->openMenu('paged-linkset');

		//build linksAllPages
		if ($currentPage > 1){
			$linkCaption = spacer().'Prev'.spacer();
			$prevIndex = $currentPage - 1;
			$link = $this->formatHref($linkCaption,$baseUrl.$prevIndex);
			$linksAllPages .= $link;
		}

		while ($i < $pages){
			$i++;
			$minRecord = (($i - 1)* $recordsPerPage) + 1;
			$maxRecord = $i * $recordsPerPage;
			if ($maxRecord > $recordCount){
				$maxRecord = $recordCount;
			}
			if ($minRecord==$maxRecord){
				$recordRange = $minRecord;
			} else {
				$recordRange = $minRecord.'-'.$maxRecord;
			}
			//highlight current page with square brackets and skip hyperlink
			if ($i == $currentPage){
				//$linkCaption = ' ['.$recordRange.'] ';
				$linkCaption = '['.$this->spacer(2).$i.$this->spacer(2).']';
				$link = \html\span($linkCaption,$this->cssItem.'-current');	
			} else {
				//$linkCaption = '('.$recordRange.')';	
				$linkCaption = $this->spacer(2).$i.$this->spacer(2);
				$link = $this->formatHref($linkCaption,$baseUrl.$i);
			}
			if ($i == 1 || ($i >= ($currentPage - 4) && $i <= ($currentPage + 4)) || $i == $pages){ 
		
				if ($i == $pages && ($currentPage + 5) < $pages){
					$linksAllPages .= span('...',$this->cssItem);
				}
				$linksAllPages .= $link;
				if ($i == 1 && ($currentPage - 5) > 1){
					$linksAllPages .= span('...',$this->cssItem);
				}
			}
		}
		
		if ($currentPage < $pages){
			$linkCaption = spacer().'Next'.spacer();
			$prevIndex = $currentPage + 1;
			$link = $this->formatHref($linkCaption,$baseUrl.$prevIndex);
			$linksAllPages .= $link;
		}
			
		if ($pages > 1){
			$linkset .= 'Found '.$recordCount.' results. ';
			$linkset .= 'Page '.$currentPage.' of '.$pages.': ';
			$linkset .= $linksAllPages;
		} else {
			$linkset .= 'Displaying '.$recordCount.' results. ';
		}
	
		$linkset .= $this->closeMenu();
	
		$this->restoreMenuSettings();
		return $linkset;
	}

	public function formatCalendarLink($baseUrl, $year, $month){
		$url = $baseUrl.'&year='.$year.'&month='.$month;
		return $url;
	}
	public function formatCalendarHref($linkCaption, $baseUrl, $year, $month){
		$url = $this->formatCalendarLink($baseUrl,$year,$month);	
		$link = $this->formatHref($linkCaption, $url);
		return $link;	
	}
}
?>
