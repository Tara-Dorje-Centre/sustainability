<?php 

class _inputSection extends _contentWriter{
protected $name;
protected $css;
protected $_section;
public function __construct(string $name,string $css){
$this->name = $name;
$this->css = $css;

	$this->_section = new \html\_div($this->name,$this->css);
	$this->addContent($this->_section->open());
}
public function input(_field $f){
$this->addContent($f->input());
}
public function button(_field $f){
	$this->addContent($f->button());
}
public function inputHidden(_field $f){
$this->addContent($f->inputHidden());
}
public function choice(_field $f,string $options){
$this->addContent($f->inputChoice($options));
}
public function print(){
	$this->addContent($this->_section->close());
return $this->getContent();
}
}

class _inputForm extends _contentWriter{
	protected $_form;
	protected $_fields;
	protected $_display;
	protected $_fieldset;
	protected $_context;
	protected $div;
	protected $entity;
	protected $mode;
	protected $url;
	protected $title;
	protected $contextMenu;
	public $required;
	public $optional;
	public $hidden;
	public $submit;

	public function __construct(string $url,string $title){
		$this->url = $url;
		$this->title = $title;
		$this->required = new _inputSection('formRequired','show');
		$this->optional = new _inputSection('formOptional','hide');
		$this->hidden = new _inputSection('formHidden','show');
		$this->submit = new _inputSection('formSubmit','show');
	}

	public function set(string $entity, string $mode, bool $toggleOptions = false){
		$this->entity = $entity;
		$this->mode = $mode;
		if ($toggleOptions == true){
	
			$elementId = 'formOptional',
	 		$toggleCaption = '+Options'){
			$url = '#!';
			$css = 'toggle-link';
			$js = "toggle('".$elementId."');";

			$l = new \html\link($url,$toggleCaption,$js,$css);
			$this->contextMenu =  $l->print();
		} else {
			$this->contextMenu = 'none';
		}
		$this->_form = new \html\_form($this->url, $this->entity.'-edit-form','editForm');
		$this->_fields = new \html\_div($this->entity.'-fields','editFields');
	}
	public function open(string $entity, string $mode, string $contextMenu = ''){
		$this->set($entity, $mode, $contextMenu);

		$this->_display = new \html\_div($this->entity.'-display-'.$this->mode,'display'.$this->mode);
		$this->addContent($this->_display->open());
		
		if (!is_null($this->contextMenu)){
			$this->_context = new \html\_div($this->entity.'-context-menu','contextMenu');
			$this->addContent($this->_context->printContent($this->contextMenu));
		}
		
		$legend = $this->mode.':  '.$this->title;
		$this->_fieldset = new \html\_fieldset($legend);
		$this->addContent($this->_fieldset->open());
		
		$this->addContent($this->_form->open());
		$this->addContent($this->_fields->open());

	}
	public function close(){ 

		$this->addContent($this->required->print());
		$this->addContent($this->optional->print());
		$this->addContent($this->submit->print());
		$this->addContent($this->hidden->print());
		
	
		$this->addContent($this->_fields->close());
		$this->addContent($this->_form->close());
		
		$this->addContent($this->_fieldset->close());
		$this->addContent($this->_display->close());
		
		return $this->getContent();
	}

}

?>
