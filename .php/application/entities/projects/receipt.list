<?php
namespace application\entities\projects;

class receiptList extends \application\entityList{

	public $showSummary = 'NO';
	public $displayLevel = 'ACTIVITY';
	public $projectId = 0;
	public $taskId = 0;
	public $activityId = 0;

 	public function __construct(){
		parent::__construct();
		$this->entityTitle = 'Receipts';
		$this->base = new receipt();
	}
	public function getRequestArguments(){
		parent::getRequestArguments();

		//push identifiers to base object
		//sets quickEdit form default idParent
		$this->base->setIdentifiers($this->pageMode,$this->id,$this->idParent,$this->idType);
		
		$display = 'ACTIVITY';
		if (isset($_GET['display-level'])){
			$display = $_GET['display-level'];
		}
		$this->setDisplayLevel($display);
		$this->base->setDisplayLevel($display);

		$show = 'NO';
		if (isset($_GET['show-summary'])){
			$show = $_GET['show-summary'];
		}
		$this->setShowSummary($show);
		$this->base->setShowSummary($show);

		$id = 0;
		if (isset($_GET['project-id'])){
			$id = $_GET['project-id'];
		}
		$this->setProjectId($id);
		$this->base->setProjectId($id);
		
		$id = 0;
		if (isset($_GET['task-id'])){
			$id = $_GET['task-id'];
		}
		$this->setTaskId($id);
		$this->base->setTaskId($id);
		
		$id = 0;
		if (isset($_GET['activity-id'])){
			$id = $_GET['activity-id'];
		}
		$this->setActivityId($id);
		$this->base->setActivityId($id);
	}
	
	public function setDisplayLevel($display = 'ACTIVITY'){
		$this->displayLevel = $display;
	}
	
	public function setShowSummary($show = 'NO'){
		$this->showSummary = $show;
	}
	
	public function setProjectId($id = 0){
		$this->projectId = $id;
	}
	
	public function setTaskId($id = 0){
		$this->taskId = $id;
	}
	
	public function setActivityId($id = 0){
		$this->activityId = $id;
	}
	
	
		
	
	protected function makePageTitle(){
		$title = '';
		
		if ($this->displayLevel == 'ACTIVITY'){
		
		} elseif ($this->displayLevel == 'TASK'){
		
		} elseif ($this->displayLevel == 'PROJECT'){
		
		}

		$this->_pageTitle = $title;
	}	

	protected function makePageMenu(){
		$menu = '';
		
		if ($this->displayLevel == 'ACTIVITY'){
		
		} elseif ($this->displayLevel == 'TASK'){
		
		} elseif ($this->displayLevel == 'PROJECT'){
		
		}
		
		$this->_pageMenu = $menu;			
	}	
	
	
	public function setFoundCount(){
		$this->echoState(true, 'setFoundCount');
		$this->echoValue(true, 'displayLevel',$this->displayLevel, 'setFoundCount');
		if ($this->displayLevel == 'ACTIVITY'){
			$sql = $this->base->sql->countActivity($this->activityId);
		} elseif ($this->displayLevel == 'TASK'){
			$sql = $this->base->sql->countTask($this->taskId);
		} elseif ($this->displayLevel == 'PROJECT'){
			$sql = $this->base->sql->countProject($this->projectId);
		}
		$this->found = $this->base->sql->getCount($sql,'count_details');
		
	}
	
	
	
	
	protected function listingSQL(){
	
		if ($this->displayLevel == 'ACTIVITY'){
			$sql = $this->base->sql->listActivity($this->activityId);
		} elseif ($this->displayLevel == 'TASK'){
			$sql = $this->base->sql->listTask($this->taskId);
		} elseif ($this->displayLevel == 'PROJECT'){
			$sql = $this->base->sql->listProject($this->projectId);
		}
	
		return $sql;
	}
	
	//override listing start 
	//to add args to paged listing
	protected function listingStart(\application\links\url $altUrl = NULL){
		
		$paging = $this->base->links->pagedListing($altUrl, $this->found,$this->resultPage,$this->perPage, $this->activityId,$this->taskId,$this->projectId,$this->showSummary,$this->displayLevel);	
		$add = '';
		if ($this->showSummary == 'NO' AND $this->displayLevel == 'ACTIVITY'){
			$add = $this->base->addForm($this->activityId);	
		}
		$entity = $this->base->entity;
		$legend = $this->entityTitle.':  Listing';
		$this->_display = new \html\displayList($entity,$paging,$legend,$add,'none');

	}
	
	
	
	
}
?>
