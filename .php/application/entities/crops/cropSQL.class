<?php
namespace application\entities;

class CropSQL{
	public function columnsCrop(){
		$c = " c.id, "; 
		$c .= " c.parent_id, "; 
		$c .= " c.common_name, "; 
		$c .= " c.variety_name, "; 
		$c .= " c.botanical_name, ";
		$c .= " c.family_name, "; 
		$c .= " c.certifications, ";
		$c .= " c.seeds_on_hand, ";
		$c .= " c.days_mature, "; 
		$c .= " c.days_mature_max, "; 
		$c .= " c.days_transplant, "; 
		$c .= " c.days_transplant_max, "; 
		$c .= " c.days_germinate, "; 
		$c .= " c.days_germinate_max, "; 
		$c .= " c.seed_depth_inches, "; 
		$c .= " c.seed_spacing_inches, "; 
		$c .= " c.thinning_height_inches, ";
		$c .= " c.inrow_spacing_inches, "; 
		$c .= " c.row_spacing_inches, "; 
		$c .= " c.site_notes, "; 
		$c .= " c.planting_notes, "; 
		$c .= " c.transplanting_notes, "; 
		$c .= " c.thinning_notes, "; 
		$c .= " c.care_notes ";
		return $c;	
	}

	public function infoCrop($cropId){
		$q = " SELECT ";	
		$q .= $this->columnsCrop();
		$q .= " FROM crops c ";
		$q .= " WHERE  ";
		$q .= " c.id = ".$cropId." ";
		return $q;
	}

	public function listCrops($parentCropId,$resultPage, $rowsPerPage, $filterSeedsOnHand = 'no'){
		$q = " SELECT ";	
		$q .= $this->columnsCrop();
		$q .= " FROM crops c ";
		if ($parentCropId >= 0){
			$q .= " WHERE c.parent_id = ".$parentCropId." ";
		}
		$q .= " ORDER BY common_name, variety_name ";
		$q .= sqlLimitClause($resultPage, $rowsPerPage);
		return $q;	
	}

	public function countCrops($parentCropId){
		$q = " SELECT ";	
		$q .= " COUNT(*) total_crops ";
		$q .= " FROM crops c ";
		if ($parentCropId >= 0){
			$q .= " WHERE c.parent_id = ".$parentCropId." ";
		}
		return $q;	
	}

	public function selectOptions_Crops($parentCropId,$filterSeedsOnHand,$selectedValue,$disabled){
		$q = " SELECT ";
		$q .= " c.id as value, ";
		$q .= " concat(
			common_name,
			if(variety_name!='',concat(':',variety_name),''),
			if(seeds_on_hand='yes','--SEEDS ON HAND','')
			) as caption ";
		$q .= " FROM crops c ";

		$filterCount = 0;
		$w = '';
		if ($parentCropId != -1){
			$w = " c.parent_id = ".$parentCropId." ";
			$filterCount++;
		}
		if ($filterSeedsOnHand	== 'yes'){
			if ($filterCount > 0){
				$w .= " AND ";
			}
			$w .= " seeds_on_hand = 'yes' ";
			$filterCount++;
		}
		if ($disabled == 'true'){
			if ($filterCount > 0){
				$w .= " AND ";
			}
			$w .= " c.id = ".$selectedValue." ";
			$filterCount++;
		}
		if ($filterCount > 0){	  
			$q .= " WHERE ".$w;
		}
		$q .= " ORDER BY caption ";
		
		//echo $q;
		return $q;	
	}
}
?>
