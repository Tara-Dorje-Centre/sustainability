<?php 

	
abstract class _entityList extends _entity{
	protected $__MyClassName = '_entityList';
	protected $_titleEntity = '[entity] List';
	
	public $found = 0;
	public $base;
	
	public function beforeSetDetails(){
	
	}
	
	//override _entity.setDetails for listing
	public function setDetails(){
		$this->beforeSetDetails();
		//check counts, dont fetch details
		$this->setFoundCount();
		
		$this->afterSetDetails();
	}
	
	public function setFoundCount(){
		$sql = $this->base->sql->count();
		$this->found = dbGetCount($sql, 'count_details');
	}
	
	protected function setPageTitle(){
		$this->_pageTitle = $this->_titleEntity;
	}
	
	//overrides _entity.getPageDetails for listing query
	protected function getPageDetails(){
		$details = $this->getListing();
		return $details;
	}
	
	protected function listingPagingLinks($baseLink = 'USE_LISTING'){
		$pagingLinks = $this->base->links->pagingLinks($this->found,$this->resultPage,$this->perPage);	
		return $pagingLinks;
	}
	
	protected function listingQuickEdit(){ 
		$quickEdit = $this->base->addForm();		
		return $quickEdit;
	}
	
	protected function listingStart(){
		$paging = $this->listingPagingLinks();
		$add = $this->listingQuickEdit();
		
	$entity = $this->_titleEntity;
	$legend = $this->_titleEntity;
		$list = openDisplayList($entity,$legend,$paging,$add);
		return $list;
	}
	
	protected function listingSQL(){
		$sql = $this->base->sql->list($this->resultPage,$this->perPage);
		return $sql;
	}
	
	protected function listingRows(){
		$sql = $this->listingSQL();
		$result = dbGetResult($sql);
		if($result){
			$list = $this->base->listHeading();
		  	while ($row = $result->fetch_assoc())
			{	
				$list .= $this->base->listRow($row);
			}
			$result->close();
		} else {
			$list =  wrapTr('no results found');
		}
		return $list;
	}
	
	public function getListing(){

		$list = $this->listingStart();
		$list .= $this->listingRows();
		$list .= closeDisplayList();
		return $list;
	}
	
	public function afterSetDetails(){

	}
	public function afterSetDefaults(){
	
	}
	public function afterDisplay(){
	
	}
 	protected function afterCollectPostValues(){
 	
 	}
	protected function editForm(){
		return 'editForm not available';
	}

}



?>
