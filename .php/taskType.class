<?php 

class taskTypeFields extends _entityTypeFields{

/******
_entityFields    id, name, description, 
highlightStyle, created, updated
idType, idParent,

_entityTypeFields  notes, displayOrder
****/
	public $frequency = 'none';
	
	public function setRowValues($row){
		parent::setRowValues($row);
		$this->frequency = ($row["frequency"]);
		
	}
	
	protected function formatForDisplay(){
		parent::formatForDisplay();
		$this->frequency = displayLines($this->frequency);
		
	}
	
	public listHeading(){
		$heading = parent::listHeading();
		$heading .= wrapTh('Frequency');
		return $heading;
	}
	
	public listDetail(){
		$detail = parent::listDetail();
		$detail .= wrapTd($this->frequency);
		return $detail;
	}
	
	public function displayDetail(){
		$detail = parent::displayDetail();
		$detail .= captionedParagraph('frequency', 'Frequency', $this->frequency);
		return $detail;
	}
	
}

class taskType extends _entityType{
	protected $__MyClassName = 'TaskType';
  	protected $_titleEntity = 'Task Type';
    protected $pageSave = 'pr_TaskType_Save.php';
	public $f;
	public $sql;
	public $links;
	
	
	public function __construct($mode = 'VIEW', $id = 0, $idParent = 0){
		parent::__construct($mode, $id, $idParent);
		
		$this->f = new taskTypeFields();
		$this->sql = new taskTypeSQL;
		$this->links new taskTypeLinks;	
	}
	

	public function optionsFrequency($selectedValue = 'none', $idName = 'frequency', $disabled = 'false'){
		$sql = "SELECT f.frequency value, f.description caption ";
		$sql .= "FROM task_type_frequencies f ";
		if ($disabled == 'true'){
			$sql = " WHERE f.frequency = '".$selectedValue."' ";	
		}
		$sql .= " ORDER BY f.display_order ";
		
		$defaultValue = 'none';
		$defaultCaption = '-not set';
		$allOptions = getSelectOptionsSQL($sql,$selectedValue,$disabled,$defaultValue,$defaultCaption);		
		
		$select = getSelectList($idName,$allOptions,'none',$disabled );
		return $select;
	}	
	
	
	public function editForm(){
		$legend = $this->pageMode;
		$legend .= $this->$_titleEntity;
		$entity = 'entity-type';

		$entity = 'task-type';
		
		$contextMenu = $this->typeLinks->formatToggleLink('formOptional','+Options');
		$form = openEditForm($entity,$legend,'pr_TaskType_Save.php',$contextMenu);
		
		//formRequired fields	
		$fields = inputFieldName($entity,$this->name,'name','Task Type');

		$fields .= inputFieldNumber($entity,$this->displayOrder,'displayOrder','Display Order');

		$fields .= inputFieldHighlightStyle($entity,$this->highlightStyle,'highlightStyle');

		

		$formRequired = $fields;
			
		//formOptional fields
		$fields = inputFieldDescription($entity,$this->description,'description');
		
		
		$select = $this->optionsFrequency($this->frequency,'frequency');
		$fields .=inputFieldSelect($entity, $select,'Frequency');

		
		$fields .= inputFieldNotes($entity,$this->notes,'notes');
		//end formOptional
		$formOptional = $fields;

				
		$hidden = getHiddenInput('mode', $this->pageMode);
		$hidden .= getHiddenInput('id', $this->id);
		$input = getSaveChangesResetButtons();
		$formSubmit = $hidden.$input;
		
		$form .= closeEditForm($entity,$formRequired,$formOptional,$formSubmit);
		return $form;
	}
	
	public function collectPostValues(){

		parent::collectPostValues();
		
		$this->f->frequency = dbEscapeString($_POST['frequency']);
		
	}
	
	protected function saveUpdate(){
	
			$sql = " UPDATE task_types AS p ";
			$sql .= " SET ";
			$sql .= " p.name = '".$this->f->name."', ";
			$sql .= " p.frequency = '".$this->f->frequency."', ";
			$sql .= " p.display_order = ".$this->f->displayOrder.", ";
			$sql .= " p.description = '".$this->f->description."', ";
			$sql .= " p.updated = CURRENT_TIMESTAMP, ";
			$sql .= " p.highlight_style = '".$this->f->highlightStyle."', ";
			$sql .= " p.notes = '".$this->f->notes."' ";
			$sql .= " WHERE p.id = ".$this->id."  ";			
			$result = dbRunSQL($sql);
	}
	
	protected function saveInsert(){
	
			$sql = " INSERT INTO task_types ";
			$sql .= " (name, ";
			$sql .= " frequency, ";
			$sql .= " display_order, ";
			$sql .= " created, ";
			$sql .= " updated, ";
			$sql .= " description, ";
			$sql .= " highlight_style, ";
			$sql .= " notes) ";
			$sql .= " VALUES (";
			$sql .= " '".$this->f->name."', ";
			$sql .= " '".$this->f->frequency."', ";
			$sql .= " ".$this->f->displayOrder.", ";
			$sql .= " CURRENT_TIMESTAMP, ";
			$sql .= " CURRENT_TIMESTAMP, ";
			$sql .= " '".$this->f->description."', ";
			$sql .= " '".$this->f->highlightStyle."', ";
			$sql .= " '".$this->f->notes."') ";
			$result = dbRunSQL($sql);
			
			$this->id = dbInsertedId();
	}


	
} 
?>
