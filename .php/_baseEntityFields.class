<?php 


 interface IentityField{
 	//public function __construct($dbColumn = 'not-used', $postVariable = 'notUsed');
 	public function set($value);
 	public function reset($default = NULL);
 	public function get();
   	public function value();
	public function setShow(string $caption, bool $list = true);
	public function setFetch(string $dbColumn);
	public function fetch($row);
	public function th();
 	public function td();
 	public function p();
 	public function post();
 	public function format();
 }
 
 abstract class _field implements IentityField{
 	protected float $valueNumber = 0;
 	protected string $valueText = '';
 	protected string $valueDate = '';
 	protected string $type = 'NUMBER';
 	protected string $caption = 'caption';
 	protected string $dbColumn = 'not-used';
 	protected string $postVariable = 'notUsed';
 	protected bool $useRow = false;
 	protected bool $usePost = false;
 	protected bool $showList = false;
 	protected bool $showDisplay = false;
 
 	public function __construct(string $dbColumn = 'not_used', string $postVariable = 'not-used'){
 		if ($dbColumn != 'not_used'){
 			$this->setFetch($dbColumn);
 		}
 		if ($postVariable != 'not-used'){
 			$this->setPost($postVariable);
 		}
 		$this->enabled(false);
 	}
 	
 	public function enabled(bool $fetch = false, bool $show = false, bool $post = false){
 		$this->useRow = $fetch;
 		$this->usePost = $fetch;
 		$this->showDisplay = $show;
 	}
 
	public function set($value){
		switch ($this->type) {
    		case 'NUMBER':
 				$this->valueNumber = $value;
        		break;
    		case 'DATE':
 		 		$this->valueDate = $value;
        		break;
    		case 'TEXT':
 		 		$this->valueText = $value;
        		break;
    		default:
 		 		$this->valueText = $value;
		}
	}
 
 	public function value(){
 		return $this->get();
 	}
 
	public function get(){
	
		switch ($this->type) {
    		case 'NUMBER':
 				$val = $this->valueNumber;
        		break;
    		case 'DATE':
 		 		$val = $this->valueDate;
        		break;
    		case 'TEXT':
 		 		$val = $this->valueText;
        		break;
    		default:
 		 		$val = $this->valueText;
		}
	}
	
 
 	public function reset($default = NULL){
 		if ($this->canSet == true){
 			$this->set($default);
 		}
 
 	}
 
 	public function setShow(string $caption, string $list = true){
		$this->caption = $caption;
		$this->showList = $list;
		$this->showDisplay = true;
 	} 
 
	public function setFetch(string $dbColumn){
		$this->useRow = true;
		$this->dbColumn = $dbColumn;
	}
 
	public function setPost(string $postVariable){
		$this->usePost = true;
		$this->postVariable = $postVariable;
	}
 
 	protected function canSet(){
 		if (($this->useRow == true) or ($this->usePost == true)){
   		$can = true;
   		} else {
   		$can = false;
   		}
   		return $can;
	}
 
	protected function canShow(){
 		if (($this->showList == true) or ($this->showDisplay == true)){
   			$can = true;
   		} else {
   			$can = false;
   		}
   		return $can;
	}
 
	public function fetch($row){
		if ($this->useRow == true){
 			$this->set($row[$this->dbColumn]);
 		}
	}

	public function th(){
		if ($this->showList == true){
 			$value = wrapTh($this->caption);
 		} else {
 			$value = '';
		}
		return $value;
 	}
 	
 	public function td(){
 		if ($this->showList == true){
  		//$this->format();
 			$value = wrapTd($this->value());
  		} else {
  			$value = '';
  		}
 		return $value;
 	}

 	public function p(){
 		if ($this->showDisplay == true){
 			//$this->format();
 			$value = para($this->caption,$this->value());
 		} else {
 			$value = '';
 		}
 		return $value;
 	}
 		
	public function post(){
  		if ($this->usePost() == true){
			switch ($this->type) {
    			case 'NUMBER':
 					$this->valueNumber = $_POST[$this->postVariable];
        			break;
    			case 'DATE':
 		 			$this->valueDate = getTimestampPostValues($this->postVariable);
        			break;
    			case 'TEXT':
 		 			$this->valueText = dbEscapeString($_POST[$this->postVariable]);
        			break;
    			default:
 		 			$this->valueText = dbEscapeString($_POST[$this->postVariable]);
			}
 		}
	}
 
 	public function format(){
 		if ($this->canShow() == true){
 			switch ($this->type) {
    			case 'NUMBER':
  					if ($this->valueNumber == ''){
  					$this->valueNumber = 0;
  					}
        			break;
    			case 'DATE':
  		  			$this->valueDate = getTimestampDate($this->valueDate);
        			break;
    			case 'TEXT':
  		  			$this->valueText = displayLines($this->valueText);
        			break;
    			default:
  		  			$this->valueText = displayLines($this->valueText);
			}
  
 		}
 	}
 	
	public function input(string $entity,string $inputType){
	
		switch ($this->inputType){
		
			case 'TEXT':
			$inputField = $this->inputAsText($entity);
			break;
			
			case 'NUMBER':
			$inputField = $this->inputAsNumber($entity);
			break;
			
			case 'HIDDEN':
			$inputField = $this->inputHidden();
			break;
			
			case 'NAME':
			$inputField = $this->inputAsName($entity);
			break;
			
			case 'DESCRIPTION':
			$inputField = $this->inputAsDescription($entity);
			break;
			
			case 'COMMENTS':
			$inputField = $this->inputAsComments($entity);
			break;
			
			case 'NOTES':
			$inputField = $this->inputAsNotes($entity);
			break;

			default:
			$inputField = $this->inputAsText($entity);
		}
		return $inputField;
	
	}
	
	public function inputAsText($entity){
		return inputFieldText($entity,$this->value(),$this->postVariable,$this->caption);
	}
	public function inputAsDescription($entity){
		return inputFieldDescription($entity,$this->value(),$this->postVariable,$this->caption);
	}
	public function inputAsNotes($entity){
		return inputFieldNotes($entity,$this->value(),$this->postVariable,$this->caption);
	}
	public function inputAsComments($entity){
		return inputFieldComments($entity,$this->value(),$this->postVariable,$this->caption);
	}
	public function inputAsName($entity){
		return inputFieldName($entity,$this->value(),$this->postVariable,$this->caption);
	}
	
	public function inputAsNumber($entity){
		return inputFieldNumber($entity,$this->value(),$this->postVariable,$this->caption);
	}
	
	public function inputHidden(){
		return getHiddenInput($this->postVariable, $this->value());
	}
 	
}

class _textField extends _field{
	public function __construct($dbColumn = 'not-used', $postVariable = 'notUsed'){
		parent::__construct($dbColumn, $postVariable);
		$this->type = 'TEXT';
	}
}
class _numberField extends _field{
	public function __construct($dbColumn = 'not-used', $postVariable = 'notUsed'){
		parent::__construct($dbColumn, $postVariable);
		$this->type = 'NUMBER';
	}
}

class _dateField extends _field{
	public function __construct($dbColumn = 'not-used', $postVariable = 'notUsed'){
		parent::__construct($dbColumn, $postVariable);
		$this->type = 'DATE';
	}

}
 
class _idNameField implements  IentityField{
	public _numberField $id;
	public _textField $name;
	
	public function __construct($dbColumnId = 'entity_id', $postVariable = 'idEntity', $dbColumnName = 'entity_name'){
		$this->id = new _numberField($dbColumnId, $postVariable);
		$this->name = new _textField($dbColumnName);
	}
	
	public function set(int $value){
	 	$this->id->set($value);
	}
 	public function reset(int $default = 0){
 		$this->id->reset($default);
 	 	$this->name->reset('');
 	}
 	public function get(){
 	   	return $this->id->get();
 	}
   	public function value(){
   		return $this->id->value();
   	}
	public function setShow(string $caption, bool $list = true){
		$this->name->setShow($caption,$list);
	}
	public function setFetch(string $dbColumn){
	//,$dbColumnName){
		$this->id->setFetch($dbColumn);
		//$this->name->setFetch($dbColumnName);
	}
	public function setFetchName(string $dbColumnName){
	//,$dbColumnName){
		//$this->id->setFetch($dbColumn);
		$this->name->setFetch($dbColumnName);
	}
	public function fetch($row){
		$this->id->fetch($row);
		$this->name->fetch($row);
	}
	public function th(){
		return $this->name->tH();
	}
	
 	public function td(){
 		return $this->name->tD();
 	}
 	public function p(){
 		return $this->name->p();
 	}
 	public function post(){
 		$this->id->post();
 	}
 	public function format(){
 	$this->name->format();
 	}
}
 
?>
