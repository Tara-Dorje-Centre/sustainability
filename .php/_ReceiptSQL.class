<?php 

class ReceiptSQL implements IentitySQL{
protected function cols(){
$c = " m.id, ";
$c .= " m.task_id, ";
$c .= " t.task_order, ";
$c .= " t.name task_name, ";
$c .= " m.activity_id, ";
$c .= " m.name, ";
$c .= " m.description, ";
$c .= " m.date_reported, ";
$c .= " m.received_by, ";
$c .= " m.received_from, ";
$c .= " m.updated, ";
$c .= " m.quantity, ";
$c .= " m.qty_unit_measure_id, ";
$c .= " uom.name qty_unit_measure_name, ";
$c .= " m.cost_unit, ";
$c .= " m.cost_actual, ";
$c .= " m.type_id, ";
$c .= " mt.name type_name, ";
$c .= " mt.highlight_style, ";
$c .= " m.notes ";
return $c;	
}

protected function tables($joinTypes = true){

$q = " FROM receipts AS m ";
$q .= " JOIN tasks AS t ON m.task_id = t.id ";
$q .= " JOIN projects AS p ON t.project_id = p.id ";

if ($joinTypes == true){
$q .= " LEFT OUTER JOIN receipt_types AS mt ON m.type_id = mt.id ";
$q .= " LEFT OUTER JOIN units_of_measure uom ON m.qty_unit_measure_id = uom.id ";
}
return $q;
}
public function info($id){
$q = " SELECT ";	
$q .= $this->cols();
$q .= $this->tables();
$q .= " WHERE  ";
$q .= " m.id = ".$id." ";
return $q;
}
public function listTask($taskId, $page = 1, $rows = 10){
$q = " SELECT ";	
$q .= $this->cols();
$q .= $this->tables();

$q .= " WHERE  ";
$q .= " m.task_id = ".$taskId." ";
$q .= " ORDER BY ";
$q .= " date(m.date_reported) desc, m.name ";
$q .= sqlLimitClause($page, $rows);
return $q;
}
public function countTask($taskId){
$q = " SELECT  ";
$q .= " COUNT(*) total_receipts";
$q .= " FROM receipts AS m ";
$q .= " WHERE  ";
$q .= " m.task_id = ".$taskId." ";
return $q;
}
public function summaryTask($taskId){
$q = " SELECT  ";
$q .= " COUNT(*) total_receipts, ";
$q .= " SUM(m.cost_actual) sum_cost_actual ";
$q .= " FROM receipts AS m ";
$q .= " WHERE  ";
$q .= " m.task_id = ".$taskId." ";
return $q;
}
public function listProject($projectId, $resultPage, $rowsPerPage, $approved = 'yes'){
$q = " SELECT ";	
$q .= $this->cols();
$q .= $this->tables();
$q .= " WHERE  ";
$q .= " t.project_id = ".$projectId." ";
$q .= " AND t.receipts_auth_project = '".$approved."' ";
$q .= " ORDER BY ";
$q .= " date(m.date_reported) desc, t.task_order, m.name ";
$q .= sqlLimitClause($resultPage, $rowsPerPage);
return $q;
}
public function countProject($projectId, $approved = 'yes'){
$q = " SELECT  ";
$q .= " COUNT(*) total_receipts";
$q .= $this->tables(false);
$q .= " WHERE  ";
$q .= " t.project_id = ".$projectId." ";
$q .= " AND t.receipts_auth_project = '".$approved."' ";
return $q;
}
public function summaryProject($projectId, $approved = 'yes'){
$q = " SELECT  ";
$q .= " COUNT(*) total_receipts, ";
$q .= " SUM(m.cost_actual) sum_cost_actual ";
$q .= $this->tables(false);


$q .= " WHERE  ";
$q .= " t.project_id = ".$projectId." ";
$q .= " AND t.receipts_auth_project = '".$approved."' ";
return $q;
}
public function summaryProjectByReceptType($projectId, $approved = 'yes'){
$q = " SELECT  ";
$q .= " IFNULL(mt.name, 'Unspecified') receipt_type, ";
$q .= " COUNT(*) total_receipts, ";
$q .= " SUM(m.cost_actual) sum_cost_actual ";


$q .= $this->tables(false);
$q .= " WHERE  ";
$q .= " t.project_id = ".$projectId." ";
$q .= " AND t.receipts_auth_project = '".$approved."' ";
$q .= " GROUP BY receipt_type ";
return $q;
}



public function count(){

}

public function list($page = 1, $rows = 10){


}


public function options($selectedId = 0, $disabled = 'false'){

}



}
?>
