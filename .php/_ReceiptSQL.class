<?php 

class ReceiptSQL extends _taskChildSQL{

protected $baseTable = 'receipts';

$fieldApproved = 'receipts_auth_project';
$fieldDate = 'date_reported';

protected function cols(){
$c = $this->select();
$c = " m.id, ";
$c .= " m.task_id, ";
$c .= " t.task_order, ";
$c .= " t.name task_name, ";
$c .= " m.activity_id, ";
$c .= " m.name, ";
$c .= " m.description, ";
$c .= " m.date_reported, ";
$c .= " m.received_by, ";
$c .= " m.received_from, ";
$c .= " m.updated, ";
$c .= " m.quantity, ";
$c .= " m.qty_unit_measure_id, ";
$c .= " uom.name qty_unit_measure_name, ";
$c .= " m.cost_unit, ";
$c .= " m.cost_actual, ";
$c .= " m.type_id, ";
$c .= " mt.name type_name, ";
$c .= " mt.highlight_style, ";
$c .= " m.notes ";
return $c;	
}

protected function tables($joinTypes = true){
$q = " FROM receipts AS m ";
$q .= " JOIN tasks AS t ON m.task_id = t.id ";
$q .= " JOIN projects AS p ON t.project_id = p.id ";
if ($joinTypes == true){
$q .= " LEFT OUTER JOIN receipt_types AS mt ON m.type_id = mt.id ";
$q .= " LEFT OUTER JOIN units_of_measure uom ON m.qty_unit_measure_id = uom.id ";
}
return $q;
}

protected function colsSummary($first = true){

$q .= " COUNT(*) total_receipts, ";
$q .= " SUM(m.cost_actual) sum_cost_actual ";
}
 
public function summaryProjectGroupType($id = 0, $approved = 'yes'){
	$q = $this->colsSummary();
$q .= " IFNULL(mt.name, 'Unspecified') receipt_type, ";
$q .= " COUNT(*) total_receipts, ";
$q .= " SUM(m.cost_actual) sum_cost_actual ";
$q .= $this->tables(false);
$q .= " WHERE  ";
$q .= $this->whereProject($id);
$q .= " AND t.receipts_auth_project = '".$approved."' ";
$q .= " GROUP BY receipt_type ";
return $q;
}




}
?>
