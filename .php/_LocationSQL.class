<?php

class LocationSQL implements IentitySQL{
function columns(){
	$c = " l.id, ";
	$c .= " l.parent_id, ";
	$c .= " l.type_id, ";
	$c .= " l.name, ";
	$c .= " l.sort_key, ";
	$c .= " l.description, ";
	$c .= " l.created, ";
	$c .= " l.updated ";
	return $c;
}



public function list($page = 1, $rows = 10){
	$q = " SELECT  ";
	$q .= $this->columns();
	$q .= " FROM locations AS l ";
	$q .= " ORDER BY l.sort_key ";

	$q .= sqlLimitClause($page, $rows);
	return $q;
}


public function listChildren($idParent, $page = 1, $rows = 10){
	$q = " SELECT  ";
	$q .= $this->columns();
	$q .= " FROM locations AS l ";
	//if ($idParent != -1){
	$q .= " WHERE l.parent_id = ".$idParent." "; 
	//} 
	$q .= " ORDER BY l.sort_key ";

	$q .= sqlLimitClause($page, $rows);
	return $q;
}

public function count(){
	$q = " SELECT  ";
	$q .= " COUNT(*) total_locations ";
	$q .= " FROM locations AS l ";
	return $q;
}

public function countChildren($id){
	$q = " SELECT  ";
	$q .= " COUNT(*) total_locations ";
	$q .= " FROM locations AS l ";
	//if ($id >= 0){
	$q .= " WHERE l.parent_id = ".$id." "; 
	//} 
	return $q;
}



public function sortKey($id){
		$sql = " SELECT l.sort_key FROM locations l WHERE l.id = ".$id.' ';
		return $sql;
}

public function sortKeyUpdate($id, $sortKey){
		
		$sql = " UPDATE locations as l	";
		$sql .= " SET l.sort_key = '".dbEscapeString($sortKey)."' ";	
		$sql .= " WHERE l.id = ".$id." ";
	return $sql;
}


public function listByParentSortKey($sortKeyParent, $idParent, $page = 1, $perPage = 10){
	$q = " SELECT  ";
	$q .= $this->columns();
	$q .= " FROM locations AS l ";
	$q .= " WHERE l.sort_key LIKE '".$sortKeyParent."%' "; 
	$q .= " AND l.id != ".$idParent." ";
	$q .= " ORDER BY l.sort_key ";
	$q .= sqlLimitClause($page, $perPage);
	return $q;
}

public function countByParentSortKey($sortKeyParent, $idParent){
	$q = " SELECT  ";
	$q .= " COUNT(*) total_locations ";
	$q .= " FROM locations AS l ";
	$q .= " WHERE l.sort_key LIKE '".$sortKeyParent."%' ";  
	$q .= " AND l.id != ".$idParent." ";	
	return $q;
}

public function info($id){
	$q = " SELECT  ";
	$q .= $this->columns();
	$q .= " FROM locations AS l ";
	$q .= " WHERE l.id = ".$id." "; 
	return $q;
}

public function options($selectedId = 0, $disabled = 'false'){
	$q = " SELECT ";
	$q .= " l.id as value, ";
	$q .= " l.sort_key as caption ";
	$q .= " FROM locations l ";
	if ($disabled == 'true'){
		$q .= " WHERE l.id = ".$selectedId." ";
	}
	$q .= " ORDER BY caption ";
	return $q;	
}






}
?>
